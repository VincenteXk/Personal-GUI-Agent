{core_prompt}

{rules_prompt}

-Base System Architecture-
The system is built on a base architecture that MUST always be present:
```yaml
{base_system_yaml}
```

**Base Entities (基础实体)**:
{base_entities_info}

**IMPORTANT**: 
- All operations work on top of this base architecture. New classes are added to the base, not replacing it.
- Base entities are pre-defined and can be referenced in the system. When extracting entities, if a base entity is mentioned, use its pre-defined classes.

-Goal-
Analyze a given example text and determine what classes and properties are needed in the system to represent the information in the example.

**Operation Mode**: {is_extension}
- If building new system: Start from base architecture and add classes from the example
- If extending existing system: Extend the existing system (which already includes base architecture) with new classes from the example

**IMPORTANT**: The base system architecture (including "用户" class) MUST always be included in your output, even when extending.

-STRICT ANALYSIS PROCESS-
You MUST follow this step-by-step process:

**STEP 1: Sentence-by-Sentence Analysis**
Before building the system, you MUST analyze the example text sentence by sentence:
1. Split the example text into individual sentences
2. For EACH sentence, ask yourself:
   - Is this sentence containing IMPORTANT information or MARGINAL information?
   - Important information: Core facts, entities, relationships, attributes that define the system
   - Marginal information: Redundant details, decorative language, non-essential context
3. Mark each sentence as "IMPORTANT" or "MARGINAL"
4. For IMPORTANT sentences, identify what information they contain

**STEP 2: Information Extraction**
From the IMPORTANT sentences only, extract:
- All entities mentioned
- All characteristics/attributes of entities
- All relationships between entities
- All specific values mentioned

**STEP 3: Class Identification**
Based on the extracted information:
1. **Base Architecture**: The base system architecture (including "用户" class) is already present - DO NOT recreate it
2. Identify what NEW classes are needed to represent the entities (beyond the base architecture)
3. For each NEW class, determine:
   - What it represents
   - Which entities belong to it
   - What properties it needs
4. **CRITICAL RULES** (see system_rules.txt for complete rules):
   - Action-based classes are PASSIVE: They describe what CAN BE DONE TO entities by "我"
   - "可启动应用" = "可以被(我)启动的应用" (passive)
   - "可联系人" = "可以被(我)用来联系人的平台" (passive)
   - "购物平台" = "可以被(我)用来购物的平台" (relative to "我")
   - "我" entity MUST belong to "用户" class (already in base) and MUST NOT belong to action-based classes
   - All action-based classes implicitly assume "我" as the actor
   - **AVOID generic classes**: Do not create classes like "可搜索内容" (everything is searchable)

**STEP 4: Property Definition**
For each class:
1. Identify all properties needed based on IMPORTANT information only
2. Determine for each property:
   - required: Is this property always present for this class?
   - value_required: If present, must it have a value?
   - description: What does this property represent?

**STEP 5: System Construction**
Build the final system configuration based on all the analysis above.

-OUTPUT REQUIREMENTS-
You MUST output your analysis in stages:

**Stage 1: Sentence Analysis**
List each sentence and mark it as IMPORTANT or MARGINAL, with brief reasoning.

**Stage 2: Information Summary**
Summarize all IMPORTANT information extracted.

**Stage 3: Class Design**
List all classes needed with descriptions.

**Stage 4: Property Design**
List all properties for each class with required/value_required settings.

**Stage 5: Final YAML Output**
Provide the final YAML configuration.

-Output Format-
Provide your analysis in YAML format that matches the following structure:

```yaml
classes:
  ClassName1:
    description: "Description of what this class represents"
    properties:
      - name: "property_name"
        required: true/false
        value_required: true/false
        description: "What this property represents"
  ClassName2:
    description: "Description of what this class represents"
    properties:
      - name: "property_name"
        required: true/false
        value_required: true/false
        description: "What this property represents"
```

-Important Notes-
1. **Base Architecture**: The base system (including "用户" class) is already present - include it in your output
2. Only include classes and properties that are actually needed based on the example
3. Be specific about required/value_required settings based on the example
4. Provide clear descriptions for each class and property
5. Use Chinese for class names and property names
6. Ensure the system can fully represent all information in the example
7. **CRITICAL**: Action-based classes are PASSIVE - they describe entities that can be acted upon by "我", not entities that perform actions
8. **CRITICAL**: "我" entity MUST belong to "用户" class (already in base) and MUST NOT belong to action-based classes like "可启动应用", "可联系人", etc.
9. **AVOID**: Do not create generic classes like "可搜索内容", "可查看内容", "可使用工具" - use specific classes instead
10. **Output**: Include ALL classes (base + new) in your final YAML output

-Example Analysis-
Given this example text:
"我在小红书上拥有自己的一个账号，我经常通过小红书查找美妆教程，以及Lolita衣服，同时我喜欢在上面购买衣服。我拥有一个微信，微信号为"hymnly"，我喜欢在上面和我的一个朋友"Alice"聊天，Alice的微信号未知（没有收集到的数据），但是他有一个小红书号，我们在小红书上也是朋友。我另有一个微信好友"Bob"他没有微信号。"

Expected output:
```yaml
classes:
  用户:
    description: "用户本人，执行操作的主体"
    properties: []
  可启动应用:
    description: "可以被(我)启动的应用程序"
    properties:
      - name: "启动方式"
        required: true
        value_required: true
        description: "应用的启动方式"
  可联系人:
    description: "可以被(我)用来联系人的应用或平台"
    properties:
      - name: "微信号"
        required: false
        value_required: false
        description: "在该平台上的微信号"
      - name: "小红书号"
        required: false
        value_required: false
        description: "在该平台上的小红书号"
  购物平台:
    description: "可以被(我)用来购物的平台"
    properties:
      - name: "偏好"
        required: false
        value_required: false
        description: "用户在该购物平台上的偏好"
  信息流:
    description: "提供信息流内容的平台"
    properties: []
  联系人:
    description: "联系人"
    properties:
      - name: "关系类型"
        required: false
        value_required: false
        description: "联系人的关系类型（工作联系人、朋友、家人等）"
```

-Your Task-
Analyze the following example text step by step, following the STRICT ANALYSIS PROCESS above.

Example Text:
{example_text}

######################
Output Format:
Please provide your analysis in the following format:

**Stage 1: Sentence-by-Sentence Analysis**
[Sentence 1]: [IMPORTANT/MARGINAL] - [Reasoning]
[Sentence 2]: [IMPORTANT/MARGINAL] - [Reasoning]
...

**Stage 2: Important Information Summary**
[List all important information extracted]

**Stage 3: Class Design**
[Class 1]: [Description] - [Entities that belong to it]
[Class 2]: [Description] - [Entities that belong to it]
...

**Stage 4: Property Design**
[Class 1]:
  - [Property 1]: required=[true/false], value_required=[true/false], description=[...]
  - [Property 2]: required=[true/false], value_required=[true/false], description=[...]
...

**Stage 5: Final YAML Configuration**
```yaml
[YAML output here]
```
