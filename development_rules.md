# 开发规则约束文档

## 基本原则

本AI助手在参与此项目开发时必须严格遵守以下规则：

## 规则1：错误处理方式
- **严禁**使用`try-except`结构来静默处理错误
- **严禁**使用`try-except`来绕过模块导入失败或其他运行时错误
- **严禁**捕获异常后仅打印警告信息而不中断程序执行
- 遇到错误时，应直接让错误暴露，以便开发者能够识别和解决根本问题

## 规则2：模块依赖处理
- **严禁**在模块不可用时创建备用实现或降级方案
- **严禁**在缺少必要依赖时编写"虚拟"或"模拟"功能
- **严禁**在不告知用户的情况下，对现有代码添加容错逻辑
- 所有模块依赖问题应直接暴露给用户，由用户决定如何解决

## 规则3：透明度要求
- 任何代码修改都必须完全透明，不得隐藏潜在问题
- 不得在用户不知情的情况下修改错误处理逻辑
- 不得为了"让代码跑起来"而添加临时性或权宜性的解决方案
- 代码应保持其原始意图和错误处理逻辑

## 规则4：用户知情权
- 所有潜在的错误或失败情况都应直接暴露给用户
- 不得通过代码修改来掩盖系统缺陷或配置问题
- 用户应能清楚了解系统的真实运行状态
- 任何可能导致错误的代码都应保持原样，除非用户明确指示修改

## 规则5：代码结构优化
- **鼓励**将功能相关的重复或嵌套类进行合并，以提高代码可读性
- **鼓励**减少不必要的抽象层，当高层封装类仅作为底层类方法的简单转发时
- **鼓励**在保持功能完整的前提下，简化类结构以降低维护复杂度
- **允许**合理的功能封装，如在VoiceAssistant类中，`ask_question_and_wait`调用`ask_question`，`listen_and_transcribe`调用`single_record`和`asr_transcribe`等，这类封装是为了提供不同层级的接口而设计的
- **鼓励**避免方法的重复嵌套实现，保持代码结构清晰

## 违规后果
违反以上规则的代码修改将被认定为不合规，需要立即回滚并按正确方式重新实现。

# 开发规则约束文档
## 示例
### ❌ 错误做法：
```python
try:
    from dialogue import VoiceAssistant
except ImportError as e:
    VoiceAssistant = None  # 静默处理错误
```

### ✅ 正确做法：
```python
from dialogue import VoiceAssistant  # 直接导入，失败则报错
```

### ❌ 错误做法：
```python
def speak(self, text: str) -> None:
    if self.assistant is None:
        print("语音功能不可用")  # 降级处理
        return
    # 实际语音功能
```

### ✅ 正确做法：
```python
def speak(self, text: str) -> None:
    # 不检查assistant是否为None，直接使用
    # 如果assistant为None则直接报错
    self.assistant.speak(text)
```

---
## 规则5：代码结构优化
- 鼓励合并功能相关的类，减少不必要的抽象层
- 减少重复代码，提高可读性
- 简化类结构，降低维护复杂度
- 避免方法的重复嵌套实现，保持代码结构清晰
- 允许合理功能封装，如VoiceAssistant类中的方法组合调用是为提供不同层级接口而设计的，但应避免完全重复的方法实现
*此文档为开发过程中的强制约束，所有代码修改必须符合以上规则。*